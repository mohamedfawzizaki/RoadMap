__________________________________________________________________________________________________________________________
#                                         Spot Instances

## üßæ What are Spot Instances?

**Spot Instances** let you buy unused **EC2 capacity** at heavily discounted rates (up to **90% cheaper** than On-Demand).

> ‚ùó AWS **can terminate Spot Instances at any time** with a 2-minute warning if it needs the capacity back.

They‚Äôre perfect for:

* **Stateless**
* **Fault-tolerant**
* **Flexible** workloads

---

## üì¶ Key Characteristics

| Attribute        | Description                                                      |
| ---------------- | ---------------------------------------------------------------- |
| üí∞ Pricing       | Dynamic; based on **supply and demand** for EC2 capacity         |
| üîÅ Interruptible | AWS **can terminate anytime** with a 2-minute notice             |
| üìâ Cost savings  | Up to **90% cheaper** than On-Demand                             |
| üß† Use case      | Batch jobs, big data, ML training, CI/CD pipelines, web crawling |

---

## üßÆ Example Price Comparison (us-east-1)

| Instance Type | On-Demand   | Spot Price (Typical) | Savings |
| ------------- | ----------- | -------------------- | ------- |
| `t3.medium`   | \$0.0416/hr | \~\$0.012/hr         | \~71%   |
| `m5.large`    | \$0.096/hr  | \~\$0.028/hr         | \~70%   |
| `c6g.large`   | \$0.068/hr  | \~\$0.015/hr         | \~78%   |

> ‚ö†Ô∏è Spot prices vary **by region**, **availability zone**, and **instance type** ‚Äî they **can change every 5 minutes.**

---

## üö® Spot Interruption Behavior

If AWS needs capacity back, your Spot instance will be:

* **Interrupted**
* Given a **2-minute termination notice**
* You can choose how to handle it:

  * Terminate
  * Stop (for EBS-backed instances)
  * Hibernate (if supported)

---

## üß† Use Cases (Where Spot Shines)

| Use Case                             | Why Spot Works                                    |
| ------------------------------------ | ------------------------------------------------- |
| **Batch processing**                 | Jobs can restart or run in chunks                 |
| **Big Data (Hadoop, Spark)**         | Parallel processing with retry logic              |
| **Machine Learning Training**        | Can checkpoint and resume                         |
| **Image rendering / video encoding** | Resumable, long-running compute jobs              |
| **CI/CD builds**                     | Retryable builds in GitHub Actions, Jenkins, etc. |
| **Web crawling / ETL jobs**          | Stateless and fault-tolerant workloads            |

---

## ‚ùå When Not to Use Spot

| Scenario                                   | Risk                                             |
| ------------------------------------------ | ------------------------------------------------ |
| Stateful DB servers                        | Risk of termination causes data loss             |
| Latency-sensitive APIs                     | User experience may be disrupted                 |
| Production workloads requiring high uptime | Spot interruptions can cause service degradation |

---

## üîÅ Spot Instance Lifecycle

1. **Request made**
2. AWS **checks availability and price**
3. If capacity is available, instance is **launched**
4. Runs until:

   * Terminated by you, **or**
   * AWS reclaims capacity (with 2-minute warning)

---

## üìã How to Launch Spot Instances

### 1. **EC2 Console (GUI)**

* Go to **Launch Instance**
* Under **Purchase Options**, select **"Request Spot Instance"**

### 2. **AWS CLI**

```bash
aws ec2 run-instances \
  --instance-market-options '{"MarketType":"spot"}' \
  --image-id ami-0abcdef1234567890 \
  --instance-type t3.medium \
  --count 1
```

### 3. **Auto Scaling Group (recommended)**

Use **Mixed Instance Policies** with:

* On-Demand
* Spot
* Weighted instances

> Best way to run production-ready fleets that take advantage of spot capacity.

---

## üìä Monitoring Spot Instances

Use:

* **CloudWatch Alarms** for termination notices
* **Spot Instance Advisor**: [https://aws.amazon.com/ec2/spot/instance-advisor](https://aws.amazon.com/ec2/spot/instance-advisor)
* **Spot Fleet history** (if using EC2 Fleet)

---

## üß† Spot Fleet & EC2 Auto Scaling

To manage pools of Spot + On-Demand instances:

* Use **EC2 Auto Scaling Group with Spot allocation strategy**
* Or use **EC2 Fleet / Spot Fleet** for more advanced controls

### Spot Allocation Strategies:

| Strategy                         | Description                                       |
| -------------------------------- | ------------------------------------------------- |
| **LowestPrice**                  | Selects the cheapest pool available               |
| **CapacityOptimized**            | Chooses the most stable capacity                  |
| **CapacityOptimizedPrioritized** | Mix of stability + your instance preferences      |
| **PriceCapacityOptimized**       | Smart balance of price and capacity (recommended) |

---

## üõ°Ô∏è Spot Instance Best Practices

| Practice                              | Description                             |
| ------------------------------------- | --------------------------------------- |
| ‚úÖ Use ASG with mixed policies         | Combine Spot + On-Demand for HA        |
| üß† Use interruption handling          | Save checkpoints or terminate cleanly   |
| ‚òÅÔ∏è Use Spot for stateless services    | Web servers, batch jobs, etc.           |
| üì¶ Use **CapacityOptimized** strategy | Higher success rate for long jobs       |
| üîî Monitor with CloudWatch            | Get 2-minute interruption notifications |
| üö¶ Use Spot Termination Notice Script | Example below üëá                         |

```bash
#!/bin/bash
while sleep 5; do
  if [ -f /dev/termination-notice ]; then
    echo "Termination notice received!" | wall
    shutdown -h now
  fi
done
```

---

## üí∞ Cost Savings Potential

| Scenario                 | Monthly On-Demand | Monthly Spot              | Savings   |
| ------------------------ | ----------------- | ------------------------- | --------- |
| 10 √ó `t3.medium` √ó 24x7  | \~\$302           | \~\$86                    | **\~71%** |
| 5 √ó `m5.large` for batch | \~\$350           | \~\$105                   | **\~70%** |
| 20k Lambda invocations   | No effect         | Use Savings Plans instead | ‚Äî         |

---

## üìå Summary Table

| Feature        | Description                                 |
| -------------- | ------------------------------------------- |
| Discount       | Up to 90%                                   |
| Availability   | Based on spare capacity                     |
| Interruption   | 2-minute warning                            |
| Use Cases      | Batch, ML, rendering, CI/CD                 |
| Launch Options | Console, CLI, EC2 Fleet, Auto Scaling Group |
| Risk           | Instances can be terminated anytime         |

---

## üß† Should You Use Spot?

Use Spot **IF**:

* Your app is stateless or checkpointed
* You can tolerate **interruptions**
* You want to **reduce EC2 costs massively**

Don‚Äôt use Spot for:

* Stateful production DBs
* Low-latency, high SLA APIs
* High-memory or single-AZ strict workloads

---
