__________________________________________________________________________________________________________________________
#                                             ü¶∏ AWS IAM Roles

## üìå What Is an IAM Role?

An **IAM Role** is an identity in AWS with a set of permissions, **but no long-term credentials** (no password or access keys). 
Roles are **assumed temporarily** by users, AWS services, or applications **to perform specific tasks**.

> Think of roles as **temporary permission sets** that can be assumed when needed.

---

## üß± Key Characteristics

| Feature              | Description                                                             |
| -------------------- | ----------------------------------------------------------------------- |
| **No credentials**   | Cannot log in directly like IAM users; roles are assumed                |
| **Temporary access** | Uses **Security Token Service (STS)** to grant time-limited credentials |
| **Used by**          | AWS services, IAM users, federated identities, external accounts        |
| **Assumed via**      | `sts:AssumeRole` API or automatically by services (EC2, Lambda, etc.)   |

---

## üéØ Use Cases

| Scenario                              | Role Used By                          |
| ------------------------------------- | ------------------------------------- |
| EC2 instance accesses S3              | EC2 Instance Profile                  |
| Lambda function writes to DynamoDB    | Lambda Execution Role                 |
| User assumes elevated admin access    | IAM user assumes temporary admin role |
| AWS account A accesses B‚Äôs S3         | Cross-account access role             |
| SSO user accesses AWS account         | Federated Identity Role               |
| CI/CD pipeline deploys infrastructure | CodeBuild or GitHub Actions role      |

---

## üîê Core Elements of a Role

1. **Trusted Entity (Principal)**

   * Who can assume the role? (`IAM user`, `Service`, `Account`, etc.)
2. **Permissions (Policy)**

   * What the role is allowed to do once assumed
3. **Session Duration**

   * Default: 1 hour; can be up to 12 hours (depending on use case)
4. **Optional Conditions**

   * e.g., Require MFA to assume the role

---

## ‚öôÔ∏è How a Role Works (Mechanism)

1. **A principal (user/service) calls** `sts:AssumeRole`
2. IAM checks the **trust policy** to allow or deny the request
3. If allowed:

   * AWS STS issues **temporary credentials**
   * These credentials include:

     * `Access Key ID`
     * `Secret Access Key`
     * `Session Token`
4. The principal uses these credentials to act **as the role**

---

## üîÑ Role Types

| Role Type                    | Description                                                        |
| ---------------------------- | ------------------------------------------------------------------ |
| **Service Role**             | Assumed by an AWS service (e.g. EC2, Lambda)                       |
| **Assumed Role (manual)**    | Assumed by an IAM user or another role manually via console or CLI |
| **Cross-Account Role**       | Allows access between different AWS accounts                       |
| **Federated Role**           | Used with SSO, SAML, or external IdPs like Azure AD, Google, Okta  |
| **IAM Identity Center Role** | Automatically created and managed via IAM Identity Center (SSO)    |

---

## üõ†Ô∏è Example Role (for EC2 to access S3)

### 1. **Trust Policy** (who can assume the role):

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Principal": { "Service": "ec2.amazonaws.com" },
    "Action": "sts:AssumeRole"
  }]
}
```

### 2. **Permissions Policy** (what the role can do):

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Action": "s3:*",
    "Resource": "arn:aws:s3:::my-bucket/*"
  }]
}
```

Attach this role to an EC2 instance ‚Üí now that instance can access S3 securely **without hardcoding credentials**.

---

## üîí Security Best Practices

‚úÖ Use **roles instead of access keys** wherever possible
‚úÖ **Enforce MFA** for sensitive roles (`Condition` in trust policy)
‚úÖ **Limit permissions** to least privilege (e.g., `s3:GetObject` not `s3:*`)
‚úÖ Set **session duration** as short as practical
‚úÖ Audit role usage with **CloudTrail** and **IAM Access Analyzer**
‚úÖ **Tag roles** with project or team names for better visibility

---

## üîÅ IAM Role vs IAM User vs Group

| Feature           | IAM Role                         | IAM User                | IAM Group                        |
| ----------------- | -------------------------------- | ----------------------- | -------------------------------- |
| Credentials       | Temporary                        | Permanent               | None                             |
| Login to Console? | Only if assumed                  | Yes                     | No                               |
| Used By           | Users, services, federated users | Humans or apps          | Collection of users              |
| Access Control    | Trust + permission policies      | Permission policies     | Group-level policies             |
| Best For          | Temporary, secure access         | Long-term direct access | Managing many users' permissions |

---

## üìä Common Role Patterns

| Pattern                          | Description                                        |
| -------------------------------- | -------------------------------------------------- |
| **EC2 Instance Profile**         | Allows EC2 to access AWS APIs (e.g. S3, DynamoDB)  |
| **Lambda Execution Role**        | Grants Lambda access to AWS services               |
| **SSO Federated Role**           | SAML or OIDC-based external login                  |
| **Cross-Account Admin Role**     | Used for centralized cloud operations              |
| **MFA Role for Elevated Access** | Requires MFA to assume temporary admin permissions |

---

## üß† Summary

| Key Element   | Description                                              |
| ------------- | -------------------------------------------------------- |
| IAM Role      | Temporary identity with specific permissions             |
| Used by       | Services, users, other accounts, SSO identities          |
| Assumed via   | STS (Security Token Service)                             |
| Core parts    | Trust policy, permission policy, session duration        |
| Best practice | Use roles instead of storing access keys in apps/scripts |

---
