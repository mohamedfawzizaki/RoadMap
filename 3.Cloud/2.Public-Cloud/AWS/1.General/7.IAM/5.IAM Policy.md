__________________________________________________________________________________________________________________________
#                                       üìú AWS IAM Policies

## üìå What Is an IAM Policy?

An **IAM Policy** is a **JSON document** that defines a set of **permissions** ‚Äî describing what **actions** are allowed or denied, on which **resources**, and under what **conditions**.

> IAM policies are how AWS controls **who can do what** to which AWS resources.

---

## üß© Basic Structure of a Policy

A policy is composed of:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow" or "Deny",
      "Action": "aws-service:operation",
      "Resource": "arn:aws:service:region:account-id:resource",
      "Condition": { ... optional ... }
    }
  ]
}
```

---

## üîπ Key Elements Explained

| Element       | Description                                                          |
| ------------- | -------------------------------------------------------------------- |
| **Version**   | Always use `"2012-10-17"` ‚Äì the current IAM policy language version  |
| **Statement** | One or more permission blocks                                        |
| **Effect**    | Either `Allow` or `Deny` (Deny always wins)                          |
| **Action**    | AWS operations like `s3:GetObject`, `ec2:StartInstances`, etc.       |
| **Resource**  | Specific resources (identified via ARNs) to which the action applies |
| **Condition** | Optional restrictions (IP, MFA, tags, time, etc.)                    |

---

## üéØ Types of IAM Policies

| Type                             | Description                                                       |
| -------------------------------- | ----------------------------------------------------------------- |
| **Managed Policy (AWS)**         | Pre-built by AWS (e.g., `AmazonS3ReadOnlyAccess`)                 |
| **Customer Managed Policy**      | Custom-built by you, reusable across users/roles                  |
| **Inline Policy**                | Directly embedded in a single user, group, or role                |
| **Permissions Boundary**         | Limits the **maximum** permissions a role or user can get         |
| **Session Policy**               | Temporary limits during a session (via STS or role assumption)    |
| **Service Control Policy (SCP)** | Used in AWS Organizations to set max permissions for accounts/OUs |

---

## üß† Understanding the `Action` Element

`Action` defines what operations are permitted.

Examples:

* `s3:ListBucket`
* `ec2:StartInstances`
* `iam:CreateUser`
* `"*"` (all actions ‚Äî not recommended unless scoped tightly)

> You can also use wildcards:

```json
"Action": "s3:Get*"
```

---

## üéØ Understanding the `Resource` Element

Defines **what resources** the policy applies to.

Examples:

* `arn:aws:s3:::my-bucket`
* `arn:aws:ec2:us-east-1:123456789012:instance/*`

Use `"*"` for all resources (with caution).

---

## üîê Understanding the `Condition` Element

Used to restrict when/how the policy is valid.

Common condition keys:

* `aws:SourceIp` ‚Üí Restrict to corporate IPs
* `aws:MultiFactorAuthPresent` ‚Üí Require MFA
* `aws:RequestTag` ‚Üí Enforce tagging
* `aws:CurrentTime` ‚Üí Time-based access

Example:

```json
"Condition": {
  "Bool": { "aws:MultiFactorAuthPresent": "true" }
}
```

---

## üõ†Ô∏è Example 1: Read-only Access to a Bucket

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Action": ["s3:GetObject", "s3:ListBucket"],
    "Resource": [
      "arn:aws:s3:::my-bucket",
      "arn:aws:s3:::my-bucket/*"
    ]
  }]
}
```

---

## üõ†Ô∏è Example 2: Allow Starting EC2 Instances Only with MFA

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Action": "ec2:StartInstances",
    "Resource": "*",
    "Condition": {
      "Bool": {
        "aws:MultiFactorAuthPresent": "true"
      }
    }
  }]
}
```

---

## üß∞ IAM Policy Evaluation Logic

1. **Explicit Deny overrides everything**
2. If **no policy allows** the action ‚Üí it is denied by default
3. If **at least one policy allows** and no policy denies ‚Üí allowed

---

## üîç IAM Policy Simulator

Use the [**IAM Policy Simulator**](https://policysim.aws.amazon.com) to:

* Test if a user/role has access
* Evaluate complex permission scenarios
* Debug why something is being denied

---

## ‚úÖ Best Practices for IAM Policies

| Practice                                                              | Why It Matters                                              |
| --------------------------------------------------------------------- | ----------------------------------------------------------- |
| üß† Use **least privilege**                                            | Only allow the exact permissions required                   |
| üì¶ Prefer **managed policies**                                        | Easier to maintain and audit                                |
| üß± Use **customer managed** for app-specific needs                    | Reuse and attach to multiple identities                     |
| üõ°Ô∏è Avoid `"*"` in `Action` and `Resource` unless scoped by condition |                                                             |
| üîê Use `Condition` for security                                       | e.g., IP whitelisting, MFA, tag enforcement                 |
| üîç Audit regularly                                                    | Use IAM Access Analyzer, Credential Reports, and CloudTrail |

---

## üìä IAM Policy Limits

| Limit                       | Value                                |
| --------------------------- | ------------------------------------ |
| Policy size (JSON)          | 6,144 characters                     |
| Managed policies per entity | 10                                   |
| Inline policies per entity  | 1 (but can have multiple statements) |
| Max permissions per request | 1,000 actions or 20KB size           |

---

## üß† Summary

| Element      | Description                                                                |
| ------------ | -------------------------------------------------------------------------- |
| IAM Policy   | A JSON document that defines what actions are allowed/denied               |
| Types        | AWS managed, customer managed, inline, SCPs, session, permissions boundary |
| Key Parts    | `Action`, `Resource`, `Effect`, optional `Condition`                       |
| Use Cases    | Attach to users, groups, roles to control access                           |
| Security Tip | Use least privilege, test with IAM Policy Simulator                        |

---
