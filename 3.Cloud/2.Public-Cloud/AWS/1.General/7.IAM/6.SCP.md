__________________________________________________________________________________________________________________________
#                                  üõ°Ô∏è AWS Service Control Policies (SCPs)

## üìå What is an SCP?

An **SCP (Service Control Policy)** is a type of **organization-level policy** in AWS Organizations that **defines the maximum available permissions** for member accounts.

A critical feature in **AWS Organizations** that helps you enforce **governance and guardrails** across accounts.

> SCPs don‚Äôt **grant** permissions ‚Äî they **limit** what IAM users and roles in an account *can* be granted.

---

## üß† Key Concept

> üß¨ Think of SCPs as a **filter layer above IAM**:

* IAM says: ‚ÄúYou can do `s3:DeleteObject`‚Äù
* SCP says: ‚ÄúYou‚Äôre not allowed to use `s3:DeleteObject` in this account‚Äù
* ‚ùå Even with IAM permission, action fails if **SCP denies it**

---

## üß± Where SCPs Apply

SCPs apply to:

* **All IAM identities** (users, groups, roles)
* **All root users** of member accounts
* Accounts grouped under **Organizational Units (OUs)**
* **All AWS services**, unless explicitly excluded

They do **not apply** to:

* **Management account (root of the org)**
* **Service-linked roles** used by AWS services (e.g., billing, support)

---

## üîÑ How SCPs Work (Evaluation Logic)

1. Evaluate **IAM policies** (identity-based + resource-based)
2. Evaluate **SCP** for the account (and OU hierarchy)
3. Final permission = **IAM allow** ‚®â **SCP allow**
4. If **SCP denies**, access is **denied**, even if IAM allows

> ‚úÖ To perform an action:
> Must be **allowed by both SCP and IAM policy**

---

## üß∞ SCP Example

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Deny",
    "Action": "s3:DeleteBucket",
    "Resource": "*"
  }]
}
```

‚ùå This SCP **prevents deleting any S3 bucket**, regardless of IAM permissions.

---

## üîì SCP vs IAM Policy

| Feature           | SCP                           | IAM Policy                               |
| ----------------- | ----------------------------- | ---------------------------------------- |
| Purpose           | Restrict maximum permissions  | Grant specific permissions               |
| Applies To        | All identities in an account  | The attached user, group, or role        |
| Scope             | Org-wide (OUs/accounts)       | Account-specific                         |
| Allow Permissions | No (just restricts)           | Yes                                      |
| Deny Permissions  | ‚úÖ Yes                         | ‚úÖ Yes                                    |
| Overrides IAM?    | ‚úÖ Yes (can block IAM "Allow") | ‚ùå No (IAM is final layer inside account) |

---

## üì¶ SCP Types

There‚Äôs only **one format**, but you can create:

* **Explicit deny SCPs**: Deny dangerous actions (e.g., `s3:DeleteBucket`)
* **Allow-only SCPs**: Deny everything except a safe list of actions
* **Full AWS access SCP**: Default AWS managed SCP

---

## üß¨ Examples of Real-World SCPs

---

### 1. ‚úÖ Allow Only Read-Only Access to S3

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Deny",
    "NotAction": [
      "s3:GetObject",
      "s3:ListBucket"
    ],
    "Resource": "*"
  }]
}
```

> Denies everything **except** reading from S3

---

### 2. üõë Prevent IAM Users from Deleting CloudTrail

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Deny",
    "Action": [
      "cloudtrail:DeleteTrail",
      "cloudtrail:StopLogging"
    ],
    "Resource": "*"
  }]
}
```

> Protects audit logs from tampering

---

### 3. üåç Prevent Access Outside Specific AWS Regions

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Deny",
    "Action": "*",
    "Resource": "*",
    "Condition": {
      "StringNotEquals": {
        "aws:RequestedRegion": [
          "us-east-1",
          "us-west-2"
        ]
      }
    }
  }]
}
```

> Enforces region restrictions for compliance or cost control

---

## üß≠ SCP Hierarchy and Inheritance

* SCPs can be attached to:

  * Individual accounts
  * Organizational Units (OUs)
* SCPs are **inherited down** the OU hierarchy
* Multiple SCPs are **merged** ‚Üí combined effect is evaluated

---

## üß™ Testing SCPs

* Use **AWS Access Analyzer** to preview effect of SCPs
* Test IAM permissions with **IAM Policy Simulator**
* Track denied actions in **CloudTrail** and **Access Advisor**

---

## ‚öôÔ∏è Best Practices for SCPs

‚úÖ Start with **FullAWSAccess** and then add restrictions
‚úÖ Use **Deny-based SCPs** (more predictable than Allow-only)
‚úÖ Use **OUs** to group accounts by security/control level
‚úÖ Protect critical services: IAM, CloudTrail, GuardDuty
‚úÖ Add **region restrictions** or **enforce encryption**
‚úÖ Use **naming conventions** and tags on SCPs
‚úÖ Regularly **audit SCPs** as part of your org security review

---

## üß† Summary

| Feature                      | Description                                             |
| ---------------------------- | ------------------------------------------------------- |
| SCP (Service Control Policy) | Defines max permissions accounts can have via IAM       |
| Used In                      | AWS Organizations                                       |
| Attached To                  | Accounts or Organizational Units                        |
| Key Rule                     | Even if IAM allows, **SCP must allow too**              |
| Best Use                     | Prevent misuse, enforce governance, ensure compliance   |
| Common Targets               | S3, CloudTrail, IAM, region usage, service restrictions |

---
