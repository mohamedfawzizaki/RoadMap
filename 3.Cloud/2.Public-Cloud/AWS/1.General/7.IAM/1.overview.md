__________________________________________________________________________________________________________________________
#                                  üîê AWS IAM (Identity and Access Management)
#                       https://docs.aws.amazon.com/iam/?icmpid=docs_homepage_security
#                       https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html

## üìå What Is IAM?

**AWS IAM** is a service that allows you to **securely manage access** to AWS services and resources. It lets you **create users, groups, roles, and policies** to control who can do what in your AWS account.

> IAM is the **core service for authorization and access control** across all AWS services.

---

## üß± Core IAM Concepts

| Concept       | Description                                                              |
| ------------- | ------------------------------------------------------------------------ |
| **IAM User**  | An identity with long-term credentials (username, password, access keys) |
| **IAM Group** | A collection of users that share the same permissions                    |
| **IAM Role**  | An identity with **temporary credentials**, assumed by users/services    |
| **Policy**    | A JSON document that defines **permissions (allow/deny)**                |
| **Principal** | The entity (user, role, federated user) **making a request**             |

---

## üë§ IAM Users

* Used for **human users**
* Can log in via:

  * AWS Console (with password)
  * AWS CLI/SDK (with access keys)
* Credentials include:

  * Username + password
  * Access key + secret key (for programmatic access)
* Can be assigned to **Groups** or granted permissions directly

---

## üë• IAM Groups

* Logical collections of IAM users
* Permissions assigned to **groups**, not individual users
* Example:

  * Group: `Developers`

    * Permissions: EC2, Lambda (read/write)
  * Group: `Auditors`

    * Permissions: CloudTrail (read-only)

---

## ü¶∏ IAM Roles

* Designed for **temporary access**
* Used by:

  * AWS services (e.g., EC2 assumes a role to access S3)
  * Cross-account access
  * Federated users (SSO, Cognito, etc.)
* No long-term credentials
* Use `AssumeRole` API to obtain **temporary security credentials**

**Use Cases:**

* EC2 instance accessing S3 without hardcoded credentials
* Lambda function reading from DynamoDB
* AWS account A accessing account B's resources

---

## üìú IAM Policies

Policies are **JSON documents** that define:

* **Actions**: What can be done (`s3:PutObject`, `ec2:StartInstances`)
* **Resources**: What resources it applies to (`arn:aws:s3:::my-bucket/*`)
* **Effect**: `Allow` or `Deny`
* **Conditions**: Optional constraints (e.g., IP, MFA, tags)

**Example Policy:**

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::my-bucket/*"
  }]
}
```

---

## üß† Types of IAM Policies

| Policy Type                      | Applied To           | Description                                  |
| -------------------------------- | -------------------- | -------------------------------------------- |
| **Identity-based**               | Users, groups, roles | Grants permissions to a principal            |
| **Resource-based**               | S3, Lambda, etc.     | Attached directly to a resource              |
| **Permissions boundaries**       | Roles/users          | Set max permissions allowed                  |
| **Service Control Policy (SCP)** | AWS Org              | Govern max permissions across an account/OUs |
| **Session Policies**             | Temporary creds      | Fine-tune permissions when assuming a role   |

---

## üîê IAM Conditions

Conditions allow you to **enforce contextual restrictions**, such as:

* IP address ranges (`aws:SourceIp`)
* Time of day (`aws:CurrentTime`)
* MFA usage (`aws:MultiFactorAuthPresent`)
* Resource tags (`aws:ResourceTag/<key>`)

> Example: Allow `ec2:StartInstances` **only from the corporate IP range**

---

## ‚öôÔ∏è IAM Permissions Evaluation Logic

1. **Deny overrides allow**
2. If no policy allows it ‚Üí **access is denied by default**
3. If a policy explicitly **denies** it ‚Üí access is denied
4. If a policy **allows** it and there‚Äôs no explicit deny ‚Üí access is granted

---

## üîç IAM Access Analyzer

* Helps detect:

  * **Unintended access** to S3, KMS, IAM, Lambda, etc.
  * Cross-account and public access
* Uses **automated reasoning** to find access paths
* Useful for audits and security hardening

---

## üìä IAM Roles for Services

| Service          | Purpose                                   |
| ---------------- | ----------------------------------------- |
| EC2 Role         | Grant EC2 instance access to AWS services |
| Lambda Role      | Allow Lambda functions to call APIs       |
| CodeBuild Role   | Build & deploy resources via CI/CD        |
| EKS/IAM Role     | Map IAM identities into Kubernetes RBAC   |
| IAM Role for SSO | Control what federated users can do       |

---

## üß∞ IAM Best Practices

‚úÖ **Enable MFA for all users (especially root)**
‚úÖ **Use roles instead of users for services**
‚úÖ **Grant least privilege** ‚Äî start with minimum permissions
‚úÖ **Rotate access keys** regularly
‚úÖ **Use IAM Access Analyzer and CloudTrail** for auditing
‚úÖ **Use permission boundaries** for delegated admin
‚úÖ **Avoid using the root account** (except for billing/account settings)

---

## ‚ùå Common Mistakes

| Mistake                                         | Consequence                                        |
| ----------------------------------------------- | -------------------------------------------------- |
| Using root account regularly                    | High risk of abuse                                 |
| Granting full `AdministratorAccess` to everyone | Violates least privilege principle                 |
| Hardcoding access keys in code                  | Secret leakage and compromise risk                 |
| Ignoring IAM policy size limits                 | IAM policy JSON size is limited (6,144 characters) |
| Not tagging IAM resources                       | Harder to track and audit                          |

---

## üß† Summary

| Feature             | Detail                                           |
| ------------------- | ------------------------------------------------ |
| IAM User            | Long-term identity for individuals               |
| IAM Role            | Temporary, assumable identity for services/users |
| IAM Group           | Organize users with shared permissions           |
| IAM Policy          | JSON doc to define permissions (allow/deny)      |
| SCP (Org-level)     | Limit max permissions across accounts/OUs        |
| Least Privilege     | Give only permissions required, nothing more     |
| IAM Access Analyzer | Detect unintended access                         |
| Logging & Auditing  | Use CloudTrail, Config, and IAM reports          |

---
