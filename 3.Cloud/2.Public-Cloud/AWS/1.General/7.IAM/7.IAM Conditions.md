__________________________________________________________________________________________________________________________
#                                         üîí AWS IAM Conditions

## üìå What Are IAM Conditions?

**IAM Conditions** are optional policy elements that **fine-tune permissions** by adding **contextual rules** to IAM policies.

They allow you to say:

> ‚ÄúThis action is allowed *only if certain conditions are true*.‚Äù

Conditions use **key-value pairs** to control **when**, **where**, or **how** a policy applies.

---

## üß† Why Use Conditions?

Conditions help you:

* Enforce **security boundaries** (e.g., require MFA)
* Limit actions to **specific IP ranges**
* Require **tags** for resource creation
* Enforce **time-based** access windows
* Bind permissions to **resource owners**

---

## üß± IAM Condition Structure

Inside a policy:

```json
"Condition": {
  "<ConditionOperator>": {
    "<ConditionKey>": "<Value>"
  }
}
```

Example:

```json
"Condition": {
  "IpAddress": {
    "aws:SourceIp": "203.0.113.0/24"
  }
}
```

---

## üîë Common Condition Keys (What You Can Check)

| Category       | Example Key                        | Description                                  |
| -------------- | ---------------------------------- | -------------------------------------------- |
| **Identity**   | `aws:username`, `aws:userid`       | Who is making the request                    |
| **Security**   | `aws:MultiFactorAuthPresent`       | MFA enabled or not                           |
| **IP Address** | `aws:SourceIp`                     | Client IP address or CIDR                    |
| **Tags**       | `aws:RequestTag/<key>`             | Tags in the request (e.g., on creation)      |
| **Resource**   | `aws:ResourceTag/<key>`            | Tags already on the resource                 |
| **Time**       | `aws:CurrentTime`, `aws:EpochTime` | Current time or timestamp                    |
| **Service**    | `s3:x-amz-server-side-encryption`  | S3-specific condition for encryption headers |

---

## ‚öôÔ∏è Common Condition Operators

| Operator                          | Purpose                             |
| --------------------------------- | ----------------------------------- |
| `StringEquals`                    | Matches exact string                |
| `StringLike`                      | Pattern match using wildcards (`*`) |
| `Bool`                            | Boolean true/false check            |
| `IpAddress`                       | Check source IP is in CIDR block    |
| `NotIpAddress`                    | Ensure source IP is **not** in CIDR |
| `DateGreaterThan`, `DateLessThan` | Time range checks                   |
| `NumericEquals`                   | Compare numeric values              |
| `ArnEquals`                       | Match ARNs                          |
| `Null`                            | Whether a key is present or not     |

> ‚úÖ Each operator has a **Not** version:
> `StringNotEquals`, `BoolIfExists`, etc.

---

## üîê Example Use Cases for IAM Conditions

---

### 1. ‚úÖ Allow access only if MFA is used:

```json
"Condition": {
  "Bool": {
    "aws:MultiFactorAuthPresent": "true"
  }
}
```

---

### 2. üåç Allow actions only from specific IP range:

```json
"Condition": {
  "IpAddress": {
    "aws:SourceIp": "203.0.113.0/24"
  }
}
```

---

### 3. ‚è∞ Allow actions only during business hours:

```json
"Condition": {
  "DateGreaterThan": {
    "aws:CurrentTime": "2025-07-13T08:00:00Z"
  },
  "DateLessThan": {
    "aws:CurrentTime": "2025-07-13T18:00:00Z"
  }
}
```

---

### 4. üè∑Ô∏è Require a specific tag on a resource:

```json
"Condition": {
  "StringEquals": {
    "aws:ResourceTag/Project": "BillingSystem"
  }
}
```

---

### 5. üì¶ Enforce S3 object encryption:

```json
"Condition": {
  "StringEquals": {
    "s3:x-amz-server-side-encryption": "AES256"
  }
}
```

---

## üß∞ Real-World Example: EC2 Creation with Mandatory Tags

```json
{
  "Effect": "Deny",
  "Action": "ec2:RunInstances",
  "Resource": "*",
  "Condition": {
    "Null": {
      "aws:RequestTag/Environment": "true"
    }
  }
}
```

üõë This policy **denies instance creation if the `Environment` tag is not provided**.

---

## üö´ Condition Gotchas

| Issue                                        | What to Watch Out For                                 |
| -------------------------------------------- | ----------------------------------------------------- |
| ‚ùó Conditions are **case-sensitive**          | `"true"` ‚â† `"True"`                                   |
| ‚ùå `Null` logic is reversed                  | `true` means the key is missing!                      |
| ‚õî Use `"Deny"` with conditions carefully    | Denies take precedence over allows                    |
| üîç Conditions apply **only where supported** | Not all services/resources support all condition keys |

---

## üß† Best Practices for IAM Conditions

‚úÖ Use conditions for **defense-in-depth security**
‚úÖ Combine with **least privilege policies**
‚úÖ Use **IP whitelisting + MFA enforcement** for admins
‚úÖ Use **mandatory tagging** to enforce compliance
‚úÖ Use IAM **Access Analyzer** to verify real impact
‚úÖ Test in the **IAM Policy Simulator** before applying to production

---

## üìä Summary

| Feature        | Description                                                  |
| -------------- | ------------------------------------------------------------ |
| IAM Conditions | Add contextual checks to IAM policies                        |
| Format         | `Condition: { Operator: { Key: Value } }`                    |
| Key Use Cases  | IP restrictions, MFA, tags, time, encryption enforcement     |
| Benefits       | Granular control, security hardening, compliance enforcement |
| Tools          | IAM Policy Simulator, Access Analyzer, CloudTrail            |

---
