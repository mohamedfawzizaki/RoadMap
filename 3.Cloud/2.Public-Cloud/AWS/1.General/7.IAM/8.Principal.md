__________________________________________________________________________________________________________________________
#                                         🧑‍⚖️ IAM Principal

## 📌 What Is a Principal in IAM?

In AWS IAM, the **Principal** is **the entity that is requesting access** to perform an action on a resource.

> In simple terms:
> **"Who" is making the request?**

You’ll see the **`Principal`** element **in trust policies**, **resource-based policies**, and **service control policies (SCPs)** — but **not** in regular identity-based policies (those attached to users or roles).

---

## 🧱 Where Is `Principal` Used?

| Context                    | `Principal` Role                                                 |
| -------------------------- | ---------------------------------------------------------------- |
| **Trust policy**           | Defines **who can assume** the IAM role                          |
| **Resource-based policy**  | Defines **who can access** a specific resource (e.g., S3 bucket) |
| **Service control policy** | Optional – used to target identities in Organizations            |
| **Identity-based policy**  | ❌ Does NOT include a `Principal` — the identity is implied     |

---

## 🧠 Principal Types

| Principal Type          | Example                                         | Description                              |
| ----------------------- | ----------------------------------------------- | ---------------------------------------- |
| **IAM User**            | `"AWS": "arn:aws:iam::111122223333:user/John"`  | Human or application IAM user            |
| **IAM Role**            | `"AWS": "arn:aws:iam::111122223333:role/Admin"` | IAM role in same or different account    |
| **AWS Account**         | `"AWS": "arn:aws:iam::111122223333:root"`       | Entire AWS account, all identities       |
| **Service Principal**   | `"Service": "lambda.amazonaws.com"`             | AWS service assuming a role              |
| **Federated Principal** | `"Federated": "cognito-identity.amazonaws.com"` | External IdP or SAML/OIDC federated user |
| **Anonymous (Public)**  | `"AWS": "*"`                                    | Anyone on the internet (⚠️ dangerous!)   |

---

## 🔐 Principal in a Trust Policy (IAM Role)

Trust policies define **who can assume a role**.

```json
{
  "Effect": "Allow",
  "Principal": {
    "AWS": "arn:aws:iam::111122223333:user/John"
  },
  "Action": "sts:AssumeRole"
}
```

✅ This allows IAM user **John** to assume the role using STS.

---

## 📦 Principal in a Resource-based Policy (S3 Example)

```json
{
  "Effect": "Allow",
  "Principal": {
    "AWS": "arn:aws:iam::111122223333:role/AppRole"
  },
  "Action": "s3:GetObject",
  "Resource": "arn:aws:s3:::my-bucket/*"
}
```

✅ This allows the IAM role `AppRole` to read from the S3 bucket.

---

## 🛠️ Service Principal Example (Lambda Role)

```json
{
  "Effect": "Allow",
  "Principal": {
    "Service": "lambda.amazonaws.com"
  },
  "Action": "sts:AssumeRole"
}
```

✅ This allows the **Lambda service** to assume the role when executing a function.

> 🔍 Each AWS service has its **own service principal name**, like:

* `ec2.amazonaws.com`
* `codebuild.amazonaws.com`
* `ecs-tasks.amazonaws.com`

---

## 🌐 Anonymous Principal (`*`)

```json
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "s3:GetObject",
  "Resource": "arn:aws:s3:::my-public-bucket/*"
}
```

⚠️ This allows **everyone** (no authentication) to read S3 objects. Use with **extreme caution**.

---

## 👥 Multiple Principals

You can define multiple principals in one statement:

```json
"Principal": {
  "AWS": [
    "arn:aws:iam::111122223333:user/John",
    "arn:aws:iam::111122223333:role/ReadOnlyRole"
  ]
}
```

---

## 🔄 Cross-Account Principal Example

To allow a role from **Account B** to access a resource in **Account A**:

```json
"Principal": {
  "AWS": "arn:aws:iam::AccountB-ID:role/ExternalRole"
}
```

Make sure Account B trusts Account A in **their trust policy** too.

---

## 🧾 Best Practices for Using `Principal`

✅ Always scope principals as narrowly as possible
✅ Avoid `Principal: "*"` unless explicitly needed (e.g., public website assets)
✅ Validate principal ARNs using **Access Analyzer**
✅ For cross-account access, use roles and **explicit trust + permission policies**
✅ When using `Service` principal, verify it matches the intended AWS service

---

## 🧠 Summary

| Feature       | Description                                                   |
| ------------- | ------------------------------------------------------------- |
| IAM Principal | The **actor** (user, role, service, account) making a request |
| Used In       | Trust policies, resource-based policies                       |
| Types         | IAM user, IAM role, account root, service, federated          |
| Not Used In   | Identity-based policies (user/group/role attached)            |
| Risks         | Using `Principal: "*"` grants public access (risky!)          |

---
