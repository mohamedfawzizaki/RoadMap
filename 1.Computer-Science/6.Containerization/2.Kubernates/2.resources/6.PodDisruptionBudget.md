___________________________________________________________________________________________________________________________

---

## üöß What is a PodDisruptionBudget?

A **`PodDisruptionBudget` (PDB)** is a Kubernetes policy that:

* **Limits the number or percentage of Pods** that can be **voluntarily disrupted** at a time.
* Helps maintain **application availability** during:

  * Node drains (`kubectl drain`)
  * Voluntary evictions
  * Cluster upgrades
  * Autoscaling or rolling updates

---

## ‚öñÔ∏è Voluntary vs Involuntary Disruptions

| Type            | Example                                   | PDB Affects? |
| --------------- | ----------------------------------------- | ------------ |
| **Voluntary**   | `kubectl drain`, cluster upgrade, scaling | ‚úÖ Yes        |
| **Involuntary** | Node failure, OOM kill, kernel panic      | ‚ùå No         |

PDBs **only apply to voluntary disruptions**.

---

## üß± Basic PDB YAML Structure

```yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: my-app-pdb
  namespace: my-namespace
spec:
  minAvailable: 2  # or use `maxUnavailable` instead
  selector:
    matchLabels:
      app: my-app
```

---

## üéõÔ∏è Key Fields Explained

| Field            | Description                                                                |
| ---------------- | -------------------------------------------------------------------------- |
| `minAvailable`   | Minimum number (or %) of pods that must remain available during disruption |
| `maxUnavailable` | Maximum number (or %) of pods that can be disrupted at once                |
| `selector`       | Label selector that matches the pods this PDB applies to                   |

---

## üìä `minAvailable` vs `maxUnavailable`

You **must set one**, not both.

| Field            | Behavior                                                                    |
| ---------------- | --------------------------------------------------------------------------- |
| `minAvailable`   | Ensures at least **N pods stay running** (e.g., `minAvailable: 2`)          |
| `maxUnavailable` | Allows up to **N pods to be disrupted at once** (e.g., `maxUnavailable: 1`) |

You can use **absolute numbers** (`2`) or **percentages** (`50%`).

---

## ‚úÖ Example 1: Maintain At Least 1 Pod

```yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: backend-pdb
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: backend
```

‚Üí Ensures at least 1 backend pod is running **at all times**.

---

## ‚úÖ Example 2: Allow 1 Pod to Be Disrupted

```yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: web-pdb
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: web
```

‚Üí Up to 1 web pod can be disrupted at a time.

---

## üß™ Real-World Use Case: Rolling Updates

Imagine a `Deployment` with 5 replicas and:

```yaml
maxUnavailable: 1
```

During a rolling update, **Kubernetes can only take down 1 pod at a time**, ensuring the app remains mostly available.

---

## üõ†Ô∏è How to Check PDB Status

```bash
kubectl get poddisruptionbudgets
```

Example output:

```
NAME         MIN AVAILABLE   ALLOWED DISRUPTIONS   CURRENT   DESIRED
my-app-pdb   2               1                     5         5
```

### Key columns:

* **ALLOWED DISRUPTIONS**: How many pods can be voluntarily evicted right now.
* **CURRENT**: How many matching pods exist now.
* **DESIRED**: Number required to meet the policy.

---

## ‚ùå What Happens if You Violate a PDB?

Try draining a node with protected pods:

```bash
kubectl drain <node-name> --ignore-daemonsets
```

You‚Äôll see:

```
cannot evict pod as it would violate the pod's disruption budget
```

Kubernetes will **block** the eviction to preserve your policy.

---

## üìå Important Notes

* **PDBs only work for controllers**: Deployment, StatefulSet, ReplicaSet, etc.
* They do **not** protect pods created by:

  * Static pods
  * Bare pods not controlled by any controller
* They do not affect **involuntary disruptions** like node crashes.
* They‚Äôre **namespace-scoped**.

---

## üîê Best Practices

| Practice                             | Why It Helps                                             |
| ------------------------------------ | -------------------------------------------------------- |
| Use PDB for all critical Deployments | Prevent accidental downtime during upgrades or scaling   |
| Tune min/max values to app tolerance | For example, `minAvailable: 2` for quorum-based systems  |
| Avoid PDBs with `replicas: 1`        | It‚Äôll block disruptions unless you're okay with downtime |
| Combine with `PriorityClass`         | Prioritize critical apps + limit disruption              |
| Use labels consistently              | So PDBs always match your pods correctly                 |

---

## üìò Advanced Example: Use Percentage

```yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: api-pdb
spec:
  maxUnavailable: 25%
  selector:
    matchLabels:
      app: api
```

‚Üí Allows **25% of pods** in the `api` group to be evicted at once.

---
