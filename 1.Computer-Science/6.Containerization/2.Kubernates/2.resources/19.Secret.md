___________________________________________________________________________________________________________________________

---

## 🔐 What is a Kubernetes Secret?

A **Secret** is a Kubernetes object used to store and manage **sensitive information** such as:

* Passwords
* OAuth tokens
* SSH keys
* TLS certificates

Secrets are stored separately from application code and can be injected into pods securely.

---

## 🧠 Why use Secrets?

* Avoid hardcoding sensitive data in container images or manifests
* Provide secure access to sensitive data at runtime
* Control access via Kubernetes RBAC
* Optionally encrypt Secrets at rest (with Kubernetes EncryptionConfig)
* Prevent sensitive info from being exposed in logs or UI

---

## 🧾 Types of Secrets

| Secret Type                      | Description                             |
| -------------------------------- | --------------------------------------- |
| `Opaque` (default)               | Arbitrary key-value pairs               |
| `kubernetes.io/tls`              | TLS certificates (`tls.crt`, `tls.key`) |
| `kubernetes.io/dockerconfigjson` | Docker registry credentials             |
| `kubernetes.io/basic-auth`       | Username and password                   |
| `kubernetes.io/ssh-auth`         | SSH private key                         |
| `bootstrap.kubernetes.io/token`  | Bootstrap tokens                        |

---

## 🔑 Anatomy of a Secret

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
data:
  username: bXl1c2Vy    # base64 of 'myuser'
  password: bXlwYXNzd29yZA== # base64 of 'mypassword'
```

* **Data** fields **must be base64-encoded**.
* Use `stringData` to provide plaintext (Kubernetes will base64-encode it).

---

## 📤 Using `stringData` (easier for humans)

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
stringData:
  username: myuser
  password: mypassword
```

---

## 🔍 How to create a Secret via CLI

### From literal values

```bash
kubectl create secret generic my-secret --from-literal=username=myuser --from-literal=password=mypassword
```

### From files

```bash
kubectl create secret generic tls-secret --from-file=tls.crt=path/to/tls.crt --from-file=tls.key=path/to/tls.key
```

---

## 📥 Using Secrets in Pods

### 1. As environment variables

```yaml
env:
- name: USERNAME
  valueFrom:
    secretKeyRef:
      name: my-secret
      key: username
- name: PASSWORD
  valueFrom:
    secretKeyRef:
      name: my-secret
      key: password
```

### 2. As mounted files (volume)

```yaml
volumes:
- name: secret-volume
  secret:
    secretName: my-secret
containers:
- name: app
  image: nginx
  volumeMounts:
  - name: secret-volume
    mountPath: /etc/secret
```

Files like `/etc/secret/username` and `/etc/secret/password` will be created.

---

## ⚙️ Managing Secret Updates

* When a Secret is updated, pods using it as env vars need restart to see changes.
* Pods with secrets mounted as volumes get updates automatically (with some delay).

---

## 🔐 Security Best Practices

* Enable **encryption at rest** for Secrets in your cluster.
* Use **RBAC** to restrict who can view and create Secrets.
* Avoid logging Secrets or printing them in debug output.
* Use **external secret stores** (HashiCorp Vault, AWS Secrets Manager) with Kubernetes integration for stronger security.
* Rotate secrets regularly.

---

## 🧪 Inspecting Secrets

```bash
kubectl get secrets
kubectl describe secret my-secret
kubectl get secret my-secret -o yaml
kubectl get secret my-secret -o jsonpath='{.data.password}' | base64 --decode
```

---

## Example: TLS Secret

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: tls-secret
type: kubernetes.io/tls
data:
  tls.crt: <base64-encoded-cert>
  tls.key: <base64-encoded-key>
```

Used typically in TLS ingress or pods requiring certificates.

---

## Summary

| Aspect            | Details                                    |
| ----------------- | ------------------------------------------ |
| Purpose           | Store sensitive info securely              |
| Data Encoding     | base64-encoded                             |
| Types             | Opaque, TLS, Docker, SSH, Basic Auth, etc. |
| Injection Methods | Environment variables, Volume mounts       |
| Security Features | Encryption at rest, RBAC controls          |

---
