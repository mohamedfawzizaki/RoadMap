___________________________________________________________________________________________________________________________

---

## üöÄ What is `PriorityClass`?

A **`PriorityClass`** is a **non-namespaced Kubernetes object** that defines the **priority value** for pods. It determines:

1. **Which pods get scheduled first** during resource contention.
2. **Which pods are evicted first** when the node runs out of resources.

It plays a **key role** in **scheduling fairness** and **survivability during stress** (e.g., in production environments).

---

## üìä Why Use PriorityClass?

| Feature                | Benefit                                                           |
| ---------------------- | ----------------------------------------------------------------- |
| ü•á Scheduling Priority | Higher-priority pods are scheduled before lower ones              |
| üõë Eviction Order      | Lower-priority pods are evicted first under resource pressure     |
| üîí Preemption          | Higher-priority pods can preempt (evict) lower-priority pods      |
| ‚úÖ Production Hardening | Critical apps (e.g., monitoring, core services) stay alive longer |

---

## üß± Anatomy of a PriorityClass

```yaml
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: high-priority
value: 1000
globalDefault: false
description: "Used for critical system components."
```

### üîë Key Fields

| Field           | Description                                                          |
| --------------- | -------------------------------------------------------------------- |
| `name`          | Unique name of the PriorityClass                                     |
| `value`         | Integer that represents priority level (**higher = more important**) |
| `globalDefault` | Only one PriorityClass can have this set to `true`                   |
| `description`   | Optional, describes when this PriorityClass should be used           |

---

## üî¢ Priority Value

* `value` is an **integer** (positive, negative, or zero).
* The **higher the value**, the **higher the scheduling/eviction priority**.
* Kubernetes itself reserves a few ranges:

  * **`system-cluster-critical`**: `2000000000`
  * **`system-node-critical`**: `2000001000`

You can define your own, for example:

| Name            | Value   | Use Case                     |
| --------------- | ------- | ---------------------------- |
| `prod-critical` | `10000` | Critical prod services       |
| `dev-default`   | `0`     | Default developer pods       |
| `low-priority`  | `-1000` | Batch jobs, can be preempted |

---

## üß™ Using PriorityClass with Pods

When defining a pod (or Deployment, Job, etc), use:

```yaml
spec:
  priorityClassName: high-priority
```

Example:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
spec:
  containers:
  - name: app
    image: nginx
  priorityClassName: high-priority
```

---

## ‚ö†Ô∏è Important Notes

* If no `priorityClassName` is set, Kubernetes assigns the pod the `globalDefault` PriorityClass (if defined), or a value of **zero**.
* Only **one** PriorityClass can have `globalDefault: true`.

---

## üìå Example: Two PriorityClasses

```yaml
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: prod-critical
value: 10000
globalDefault: false
description: "Used for critical production workloads."

---
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: dev-default
value: 0
globalDefault: true
description: "Default priority for developer workloads."
```

---

## üö® Pod Preemption

* Kubernetes may **evict lower-priority pods** to make room for higher-priority ones.
* This only works if **preemption is enabled** (it is by default).
* Works best with **PodDisruptionBudgets** and **node-level constraints**.

---

## üß† Use Cases

| Use Case                    | PriorityClass Example          |
| --------------------------- | ------------------------------ |
| System components           | `system-node-critical`         |
| Monitoring/Logging services | `prod-critical` (value: 10000) |
| Web frontends               | `web-frontend` (value: 5000)   |
| Background jobs             | `low-priority` (value: -1000)  |

---

## ‚úÖ Best Practices

| Practice                                      | Reason                                               |
| --------------------------------------------- | ---------------------------------------------------- |
| Reserve high values for mission-critical apps | Avoid preempting unnecessarily                       |
| Set a `globalDefault` PriorityClass           | So pods with no priority still get predictable value |
| Avoid too many close-range values             | Keep class separation meaningful                     |
| Use PodDisruptionBudgets for critical pods    | Prevent unintentional evictions                      |

---

## üìä Checking Priority of Running Pods

```bash
kubectl get pods -n my-namespace -o custom-columns=NAME:.metadata.name,PRIORITY:.spec.priority
```

Or describe a pod:

```bash
kubectl describe pod my-pod
```

---
