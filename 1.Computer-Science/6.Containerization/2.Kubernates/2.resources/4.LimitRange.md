___________________________________________________________________________________________________________________________
---

## üöß What is a `LimitRange`?

A `LimitRange` is a **namespace-scoped policy** that:

* ‚úÖ Sets **default resource requests and limits** for Pods or Containers.
* ‚úÖ Specifies **minimum and maximum values** allowed for CPU, memory, or storage.
* ‚úÖ Enforces consistent resource usage across a namespace.

Think of it as **per-container/per-pod budgeting**, while `ResourceQuota` is **per-namespace total budgeting**.

---

## üß± Why Use LimitRange?

| Benefit                 | Description                                                                     |
| ----------------------- | ------------------------------------------------------------------------------- |
| **Prevents overuse**    | Limits how much a single pod/container can consume                              |
| **Sets defaults**       | Applies default CPU/memory if none are specified                                |
| **Improves scheduling** | Ensures requests/limits are always set so Kubernetes can schedule pods properly |
| **Avoids OOM kills**    | Enforces memory limits to prevent pods from crashing the node                   |

---

## üìÑ LimitRange YAML Structure

### Example: Memory & CPU Limits

```yaml
apiVersion: v1
kind: LimitRange
metadata:
  name: resource-limits
  namespace: dev
spec:
  limits:
  - type: Container
    max:
      cpu: "1"
      memory: "1Gi"
    min:
      cpu: "100m"
      memory: "128Mi"
    default:
      cpu: "500m"
      memory: "512Mi"
    defaultRequest:
      cpu: "200m"
      memory: "256Mi"
```

---

## üîë Key Fields

| Field                  | Description                                                                         |
| ---------------------- | ----------------------------------------------------------------------------------- |
| `type`                 | `Container`, `Pod`, or `PersistentVolumeClaim`                                      |
| `max`                  | Max CPU/Memory allowed per container/pod                                            |
| `min`                  | Min CPU/Memory required per container/pod                                           |
| `default`              | Default limit if none is specified by the user                                      |
| `defaultRequest`       | Default request if none is specified by the user                                    |
| `maxLimitRequestRatio` | Maximum allowed `limit/request` ratio (e.g., `limit` must not exceed `request * N`) |

---

## üìå Types of `LimitRange`

| Type                    | Description                                        |
| ----------------------- | -------------------------------------------------- |
| `Container`             | Applies to each container in a Pod                 |
| `Pod`                   | Applies to the aggregate limits/requests for a Pod |
| `PersistentVolumeClaim` | Applies storage resource usage (PVCs)              |

---

## üß† How Kubernetes Uses It

If a Pod manifest **doesn't specify resources**, Kubernetes applies defaults from the `LimitRange`.

Example: if your manifest doesn't specify memory, but LimitRange defines a default of `512Mi`, that will be applied automatically.

---

## üß™ Example 1: CPU/Memory Limit Per Container

```yaml
apiVersion: v1
kind: LimitRange
metadata:
  name: cpu-mem-limits
  namespace: dev
spec:
  limits:
  - type: Container
    defaultRequest:
      cpu: "100m"
      memory: "128Mi"
    default:
      cpu: "200m"
      memory: "256Mi"
    max:
      cpu: "500m"
      memory: "512Mi"
    min:
      cpu: "50m"
      memory: "64Mi"
```

---

## üß™ Example 2: Enforcing PVC Size Ranges

```yaml
apiVersion: v1
kind: LimitRange
metadata:
  name: storage-limit
  namespace: dev
spec:
  limits:
  - type: PersistentVolumeClaim
    min:
      storage: 1Gi
    max:
      storage: 10Gi
```

---

## üîç Viewing LimitRanges

```bash
kubectl get limitranges -n dev
kubectl describe limitrange resource-limits -n dev
```

---

## ‚ö†Ô∏è What Happens If You Violate It?

If a Pod tries to:

* Request less than `min`, or
* Exceed `max` CPU/memory,

You‚Äôll see an error like:

```
Error from server (Forbidden): error when creating "pod.yaml": 
spec.containers[0].resources.requests.memory: Invalid value: "10Gi": exceeds the max limit
```

---

## ‚úÖ Best Practices

| Practice                                  | Benefit                                               |
| ----------------------------------------- | ----------------------------------------------------- |
| Always set `defaultRequest` and `default` | Prevents scheduling and eviction issues               |
| Combine with `ResourceQuota`              | Enforce both per-container and total namespace limits |
| Use `kubectl dry-run=client`              | Validate before applying                              |
| Apply per-environment policies            | Separate rules for dev, staging, prod                 |

---

## üîó LimitRange vs ResourceQuota

| Feature  | `LimitRange`                      | `ResourceQuota`                       |
| -------- | --------------------------------- | ------------------------------------- |
| Scope    | Per-container/PVC                 | Entire namespace                      |
| Enforces | Min, max, default requests/limits | Total usage limits (e.g., total pods) |
| Use Case | Developer guardrails              | Multi-tenant usage enforcement        |

---

## üìò Example: Combine `LimitRange` + `ResourceQuota`

```yaml
# Namespace
apiVersion: v1
kind: Namespace
metadata:
  name: dev
---
# LimitRange
apiVersion: v1
kind: LimitRange
metadata:
  name: defaults
  namespace: dev
spec:
  limits:
  - type: Container
    defaultRequest:
      cpu: "200m"
      memory: "256Mi"
    default:
      cpu: "400m"
      memory: "512Mi"
---
# ResourceQuota
apiVersion: v1
kind: ResourceQuota
metadata:
  name: dev-quota
  namespace: dev
spec:
  hard:
    requests.cpu: "2"
    limits.cpu: "4"
    pods: "10"
```

---
