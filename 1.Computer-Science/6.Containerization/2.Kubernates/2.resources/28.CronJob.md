___________________________________________________________________________________________________________________________

---

# What is a CronJob?

A **CronJob** in Kubernetes is a controller that creates Jobs on a **time-based schedule**, similar to the classic Linux `cron` utility.

* Automates running batch tasks or maintenance scripts at regular intervals.
* Manages scheduled execution of Jobs, including retries and concurrency policies.

---

# Why use CronJob?

* Automate periodic tasks: backups, database cleanups, report generation, batch jobs.
* Run maintenance scripts or workflows at defined times.
* Control concurrency of scheduled Jobs.
* Manage failed or missed Jobs with retry and history limits.

---

# Anatomy of a CronJob YAML

```yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: "*/5 * * * *"  # Every 5 minutes
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; echo Hello from the Kubernetes cluster
          restartPolicy: OnFailure
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
```

---

# Key Fields Explained

| Field                        | Description                                                      |
| ---------------------------- | ---------------------------------------------------------------- |
| `schedule`                   | Cron format schedule string (e.g., `"0 0 * * *"` for midnight)   |
| `jobTemplate`                | Template for the Job that runs at each scheduled time            |
| `successfulJobsHistoryLimit` | How many successful finished Jobs to keep in history (default 3) |
| `failedJobsHistoryLimit`     | How many failed Jobs to keep in history (default 1)              |
| `concurrencyPolicy`          | How to handle concurrent Jobs (`Allow`/`Forbid`/`Replace`)       |
| `startingDeadlineSeconds`    | Deadline in seconds for starting a missed job                    |
| `suspend`                    | Boolean to suspend subsequent executions temporarily             |

---

# Scheduling Format

* Uses standard **cron format** with five fields:
  `minute hour day-of-month month day-of-week`
* Examples:

  * `"0 0 * * *"` — run daily at midnight
  * `"*/15 * * * *"` — run every 15 minutes
  * `"0 8 * * 1-5"` — run at 8 AM Monday to Friday

---

# Concurrency Policies

Controls what happens if a new job is scheduled to run but the previous one is still active:

| Policy    | Description                                             |
| --------- | ------------------------------------------------------- |
| `Allow`   | Allows CronJobs to run concurrently (default)           |
| `Forbid`  | Prevents new Job if previous is still running           |
| `Replace` | Cancels currently running Job and replaces with new one |

Example:

```yaml
concurrencyPolicy: Forbid
```

---

# Starting Deadline

* `startingDeadlineSeconds` sets a deadline window (in seconds) for starting a Job if it was missed (e.g., due to controller downtime).
* If the Job can't be started within this deadline, it is skipped.
* Useful to avoid backlog of jobs running after long downtime.

---

# Suspend

* Temporarily **suspend** the CronJob (pause schedule) without deleting.
* Useful for maintenance or emergency pause.

```yaml
suspend: true
```

---

# Job History Limits

* To avoid clutter, CronJob keeps a limited number of successful and failed Job histories.
* Configurable with:

```yaml
successfulJobsHistoryLimit: 5
failedJobsHistoryLimit: 2
```

---

# Example: Daily Backup CronJob

```yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: daily-backup
spec:
  schedule: "0 2 * * *"  # 2 AM daily
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: backup
            image: mybackup:latest
            args: ["backup", "--all"]
          restartPolicy: OnFailure
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 5
  failedJobsHistoryLimit: 3
```

---

# Monitoring and Managing CronJobs

* List CronJobs:

```bash
kubectl get cronjobs
```

* Describe CronJob:

```bash
kubectl describe cronjob <name>
```

* See Jobs created by CronJob:

```bash
kubectl get jobs --selector=job-name=<cronjob-name>
```

---

# Summary Table

| Feature            | Description                               |
| ------------------ | ----------------------------------------- |
| Resource type      | Controller for scheduled batch Jobs       |
| Schedule format    | Standard cron format (5 fields)           |
| Job creation       | Creates Jobs per schedule                 |
| Concurrency policy | Controls overlapping job executions       |
| Starting deadline  | Deadline for starting missed jobs         |
| Suspend            | Pause scheduling without deletion         |
| History limits     | Limits on successful/failed jobs retained |

---
