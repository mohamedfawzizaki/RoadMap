___________________________________________________________________________________________________________________________

---

# What is an Ingress?

An **Ingress** is a Kubernetes API object that manages external access to services within a cluster, typically HTTP and HTTPS routes.

* Provides **routing rules** to services based on hostnames, paths, headers, etc.
* Acts as an entry point for HTTP/S traffic into the cluster.
* Often works with an **Ingress Controller** that implements the routing.

---

# Why use Ingress?

* Expose multiple services under a single IP or hostname.
* Provide advanced HTTP routing (path-based, host-based).
* Enable TLS/SSL termination and HTTPS support.
* Centralize external access and load balancing configuration.

---

# Ingress vs Service of Type LoadBalancer / NodePort

| Feature          | Service (LoadBalancer/NodePort)   | Ingress                          |
| ---------------- | --------------------------------- | -------------------------------- |
| IP address       | One per service                   | Single IP for multiple services  |
| Protocol support | TCP/UDP                           | HTTP/S (layer 7) routing         |
| Routing          | Basic IP + port                   | Host, path, header-based routing |
| TLS termination  | Limited                           | Built-in TLS termination support |
| Cost             | May incur multiple cloud LB costs | One load balancer or external IP |

---

# Anatomy of an Ingress Resource

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: example-ingress
spec:
  ingressClassName: nginx  # selects the Ingress Controller to use
  rules:
  - host: example.com
    http:
      paths:
      - path: /foo
        pathType: Prefix
        backend:
          service:
            name: foo-service
            port:
              number: 80
      - path: /bar
        pathType: Prefix
        backend:
          service:
            name: bar-service
            port:
              number: 8080
  tls:
  - hosts:
    - example.com
    secretName: tls-secret
```

---

# Key Fields Explained

| Field              | Description                                                                        |
| ------------------ | ---------------------------------------------------------------------------------- |
| `ingressClassName` | Specifies which Ingress Controller manages this ingress (optional but recommended) |
| `rules`            | Defines hostnames and paths to route                                               |
| `host`             | Domain name for the rule                                                           |
| `http.paths`       | List of paths and their backend service targets                                    |
| `backend`          | Target service name and port                                                       |
| `tls`              | TLS termination settings, referencing Kubernetes secrets containing certs          |

---

# Path Types

* **Exact**: Matches the URL path exactly.
* **Prefix**: Matches based on a URL path prefix (default for many controllers).
* **ImplementationSpecific**: Controller decides how to interpret path.

Example:

```yaml
pathType: Prefix
```

---

# TLS / HTTPS Support

* The `tls` section allows specifying hostnames and the name of a Kubernetes Secret containing the TLS certificate and key.
* The Ingress Controller handles TLS termination.

Example Secret (must be created beforehand):

```bash
kubectl create secret tls tls-secret --cert=cert.pem --key=key.pem
```

---

# Ingress Controller

* **Ingress** resource defines *what* should happen.
* **Ingress Controller** implements *how* it happens (e.g., NGINX, Traefik, Istio).
* Must be installed and running in the cluster to process Ingress resources.

---

# Load Balancing & Routing

* Ingress Controllers typically provide **layer 7 load balancing**.
* Routes traffic based on host and path rules.
* Can provide additional features like rate limiting, authentication, rewrite, redirects.

---

# Annotations & Customization

* Many Ingress controllers support annotations to configure controller-specific features:

  * Timeouts
  * Whitelist IPs
  * Rewrite targets
  * SSL redirect
  * Health checks

Example annotation for NGINX Ingress:

```yaml
metadata:
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
```

---

# Example: Basic Ingress

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: simple-ingress
spec:
  rules:
  - host: example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web-service
            port:
              number: 80
```

---

# Advanced Features

* **Default backend:** catch-all service if no rules match.
* **Multiple hosts:** route different domains to different services.
* **Canary deployments:** route a portion of traffic to new versions.
* **Authentication:** integrate with OAuth/OpenID Connect.
* **Rate limiting & throttling.**

---

# Common Ingress Controllers

| Controller      | Notes                                       |
| --------------- | ------------------------------------------- |
| NGINX Ingress   | Most popular, widely used                   |
| Traefik         | Supports dynamic configuration              |
| HAProxy         | High-performance proxy                      |
| Istio / Linkerd | Service mesh with ingress capabilities      |
| GKE Ingress     | Managed ingress on Google Kubernetes Engine |

---

# Troubleshooting Tips

* Ensure Ingress Controller is installed and running.
* Check Ingress Controller logs for errors.
* Verify Service selectors and ports are correct.
* Validate DNS resolves to Ingress Controller IP.
* Use `kubectl describe ingress` for detailed info.

---

# Summary Table

| Aspect          | Details                                           |
| --------------- | ------------------------------------------------- |
| Resource        | Defines HTTP/S routing rules                      |
| Requires        | Ingress Controller to implement routing           |
| Routing         | Host and path based routing                       |
| TLS termination | Supported via Kubernetes Secrets                  |
| Load balancing  | Layer 7 load balancing with sticky sessions, etc. |

---

Would you like me to help with:

* Creating a complete Ingress YAML manifest with TLS and annotations?
* Explaining how Ingress integrates with Services and Ingress Controllers?
* Troubleshooting common Ingress problems?
