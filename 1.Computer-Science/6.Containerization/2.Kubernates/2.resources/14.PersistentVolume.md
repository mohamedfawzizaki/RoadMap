___________________________________________________________________________________________________________________________

---

## üì¶ What is a PersistentVolume (PV)?

A **PersistentVolume (PV)** is a piece of **storage in the cluster** that:

* Is **provisioned by an admin** (static) or **dynamically created** via a `StorageClass`
* Lives **independent of pods**, meaning it **persists beyond pod lifecycles**
* Can be **mounted to a pod** via a `PersistentVolumeClaim (PVC)`

> It is **similar to a physical disk or network drive** available to the cluster.

---

## üß† PV vs PVC vs StorageClass

| Concept                 | Role                                                 |
| ----------------------- | ---------------------------------------------------- |
| `PersistentVolume`      | The **actual storage resource** ‚Äî like a disk        |
| `PersistentVolumeClaim` | A **request for storage** by a pod                   |
| `StorageClass`          | Defines **how storage is provisioned** (dynamically) |

---

## üßæ Anatomy of a PersistentVolume (Static Example)

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-manual
spec:
  capacity:
    storage: 5Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: manual
  hostPath:
    path: /mnt/data
```

---

## üß© Key Fields Breakdown

| Field                                                                    | Description                                                      |
| ------------------------------------------------------------------------ | ---------------------------------------------------------------- |
| `capacity.storage`                                                       | The size of the volume (e.g., `10Gi`)                            |
| `volumeMode`                                                             | `Filesystem` (default) or `Block`                                |
| `accessModes`                                                            | How the volume can be mounted                                    |
| `persistentVolumeReclaimPolicy`                                          | What happens when PVC is deleted (`Retain`, `Recycle`, `Delete`) |
| `storageClassName`                                                       | Used to bind with matching PVC                                   |
| `hostPath` / `nfs` / `awsElasticBlockStore` / `gcePersistentDisk` / etc. | Backend storage type                                             |

---

## üîÅ Access Modes Explained

| AccessMode      | Meaning                                                                     |
| --------------- | --------------------------------------------------------------------------- |
| `ReadWriteOnce` | Mounted as read-write by **a single node**                                  |
| `ReadOnlyMany`  | Mounted as read-only by **many nodes**                                      |
| `ReadWriteMany` | Mounted as read-write by **many nodes** (NFS, GlusterFS, etc. support this) |

---

## üß± Example: Static PV + PVC + Pod

### 1. PersistentVolume

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-static
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  storageClassName: manual
  hostPath:
    path: /mnt/static-data
```

### 2. PersistentVolumeClaim

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-static
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
  storageClassName: manual
```

### 3. Pod Using PVC

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-using-pv
spec:
  containers:
  - name: app
    image: nginx
    volumeMounts:
    - mountPath: "/data"
      name: storage
  volumes:
  - name: storage
    persistentVolumeClaim:
      claimName: pvc-static
```

---

## ‚öôÔ∏è Reclaim Policies

| Policy    | Behavior when PVC is deleted                                          |
| --------- | --------------------------------------------------------------------- |
| `Retain`  | Keeps the data, requires manual cleanup                               |
| `Recycle` | Deprecated (tries to wipe and reuse)                                  |
| `Delete`  | Deletes the underlying storage (works only with dynamic provisioners) |

---

## üöÄ Dynamic Provisioning via StorageClass

Use a `StorageClass` to **automatically create PVs** when PVCs are created.

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast
provisioner: kubernetes.io/aws-ebs  # or csi driver
parameters:
  type: gp2
```

Then create a PVC like this:

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: dynamic-pvc
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 5Gi
  storageClassName: fast
```

üîÑ A PV will be **dynamically created and bound** to this claim.

---

## üß™ Checking PVs and PVCs

```bash
kubectl get pv
kubectl get pvc
kubectl describe pv <name>
kubectl describe pvc <name>
```

---

## üîç Binding Process

1. **PVC created** ‚Üí searches for **matching PV**
2. If `storageClassName`, `accessModes`, and size match ‚Üí PVC is bound
3. Pod uses PVC, which mounts the associated PV

---

## üí° Best Practices

| Tip                            | Why It Matters                    |
| ------------------------------ | --------------------------------- |
| Prefer dynamic provisioning    | Reduces manual work and error     |
| Use `Retain` for critical data | Prevents accidental deletion      |
| Use unique `storageClassName`s | Avoids conflicts across workloads |
| Match PVC and PV exactly       | Otherwise binding will fail       |
| Avoid `hostPath` in production | Not portable across nodes         |

---

## üìú Summary

| Concept                 | Description                                |
| ----------------------- | ------------------------------------------ |
| `PersistentVolume`      | Actual storage resource                    |
| `PersistentVolumeClaim` | Request for specific storage               |
| `StorageClass`          | Defines how dynamic storage is provisioned |
| `volumeMode`            | Filesystem (default) or raw block          |
| `accessModes`           | RWX, ROX, RWO ‚Äî define how pods mount it   |
| `reclaimPolicy`         | What happens to PV after PVC is removed    |

---
