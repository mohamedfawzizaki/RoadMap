___________________________________________________________________________________________________________________________

---

# What is a Kubernetes Job?

A **Job** creates one or more pods and ensures that a specified number of them successfully terminate (complete their work).

* Designed for **finite, batch, or one-off tasks**.
* Guarantees that the specified number of pod completions happen.
* Manages retries for failed pods until success or failure limits.

---

# Why use a Job?

* Run tasks that need to **complete successfully once** (or N times).
* Examples: database migrations, batch processing, backups, report generation.
* Unlike Deployments or StatefulSets, Jobs are for **non-continuous workloads**.

---

# Anatomy of a Job YAML

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: example-job
spec:
  completions: 3
  parallelism: 2
  backoffLimit: 4
  template:
    metadata:
      labels:
        job: example-job
    spec:
      containers:
      - name: example
        image: busybox
        command: ["sh", "-c", "echo Hello Kubernetes!; sleep 10"]
      restartPolicy: OnFailure
```

---

# Key Fields Explained

| Field           | Description                                          |
| --------------- | ---------------------------------------------------- |
| `completions`   | Total successful pod completions desired (default 1) |
| `parallelism`   | Number of pods running in parallel                   |
| `backoffLimit`  | Number of retries before marking Job as failed       |
| `template`      | Pod template spec for pods created by Job            |
| `restartPolicy` | Pod restart policy (must be `OnFailure` or `Never`)  |

---

# How Job Works

* Creates pods according to `parallelism`.
* Pods run the workload to completion.
* When a pod successfully finishes (`Succeeded`), it counts toward `completions`.
* Job finishes when total completions are reached.
* If pods fail, Job retries up to `backoffLimit`.
* After `backoffLimit` exceeded, Job is marked failed.

---

# Important Details

* `restartPolicy` for pod **must be** either `OnFailure` or `Never`. `Always` is invalid.
* Jobs are useful for **batch processing** or **finite tasks**.
* If `parallelism` < `completions`, pods run in batches.
* If `parallelism` = `completions`, pods run concurrently.

---

# Types of Jobs

### 1. Non-parallel Job (default)

* Runs a single pod until completion.

### 2. Parallel Jobs

* Run multiple pods in parallel.
* Two modes:

  * **Work queue mode:** Pods cooperate to process work units (requires external coordination).
  * **Fork-join mode:** Pods perform independent parallel work.

---

# Job Status

You can check Job status with:

```bash
kubectl get jobs
kubectl describe job example-job
```

Status includes:

* `Active` pods running.
* `Succeeded` pods completed.
* `Failed` pods failed.
* Conditions (Complete or Failed).

---

# Cleaning Up Jobs

* By default, Job pods and status remain after completion.
* Use **TTL Controller** to automatically clean up Jobs and pods after completion.

Example:

```yaml
ttlSecondsAfterFinished: 100
```

---

# Example: Simple One-Off Job

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: db-migration
spec:
  template:
    spec:
      containers:
      - name: migrate
        image: myapp:migration
        command: ["./migrate.sh"]
      restartPolicy: OnFailure
```

---

# Example: Parallel Job

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: parallel-job
spec:
  completions: 10
  parallelism: 3
  template:
    spec:
      containers:
      - name: worker
        image: busybox
        command: ["sh", "-c", "echo Processing; sleep 30"]
      restartPolicy: OnFailure
```

---

# Summary Table

| Aspect           | Description                                       |
| ---------------- | ------------------------------------------------- |
| Use case         | Run finite, batch, or one-off tasks               |
| Pod lifecycle    | Pods run to completion                            |
| Parallelism      | Supports concurrent pod execution                 |
| Completion count | Job completes when desired successful pods finish |
| Retry behavior   | Retries failed pods up to `backoffLimit`          |
| Cleanup          | Manual or via TTL Controller                      |

---
