# ================================================================================
# ğŸ“˜ Definition: ClusterRole
# --------------------------------------------------------------------------------
# ClusterRole is a non-namespaced Kubernetes RBAC resource that defines a set of
# PolicyRules (permissions) that apply cluster-wide. Unlike Role (which is scoped
# to a specific namespace), ClusterRole can grant access to:
#   âœ”ï¸ Resources across all namespaces
#   âœ”ï¸ Non-namespaced resources (like nodes, persistent volumes)
#
# ClusterRoles are typically:
#   ğŸ”¹ Referenced by ClusterRoleBinding (for global subjects like service accounts)
#   ğŸ”¹ Used for admin-level or CI/CD access
#   ğŸ”¹ Aggregated into higher-level roles using aggregationRule and labels
#
# ğŸ” Use case: Grant CI/CD pipeline or automation scripts the ability to create,
# manage, and delete workloads across namespacesâ€”securely and explicitly.
# ================================================================================
# --------------------------------------------------------------------------------
# ğŸ” ClusterRole: Grants CI service account permissions to manage common K8s objects
# --------------------------------------------------------------------------------
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: ci-clusterrole                                # ğŸ†” Logical name for this role
  labels:
    rbac.example.com/aggregate-to-monitoring: "true"  # ğŸ·ï¸ Enables dynamic aggregation if needed
rules:
  # ------------------------------------------------------------------------------
  # ğŸŒ Core API Group: Basic workload and config resources
  # ------------------------------------------------------------------------------
  - apiGroups: [""]                                   # "" = core Kubernetes API group
    resources: ["pods", "services", "configmaps", "secrets"]
    verbs: ["get", "list", "create", "delete", "watch", "update"]
  # ------------------------------------------------------------------------------
  # ğŸ§± apps.k8s.io API Group: Application controllers
  # ------------------------------------------------------------------------------
  - apiGroups: ["apps"]
    resources: ["deployments", "replicasets"]
    verbs: ["get", "list", "create", "delete", "watch", "update"]
  # ------------------------------------------------------------------------------
  # â± batch.k8s.io API Group: CI build/test/scheduled job handling
  # ------------------------------------------------------------------------------
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["get", "list", "create", "delete", "watch", "update"]
  # ------------------------------------------------------------------------------
  # ğŸ” RBAC API Group: For CI systems that need to bootstrap access or delegate
  # ------------------------------------------------------------------------------
  - apiGroups: ["rbac.authorization.k8s.io"]
    resources: ["roles", "rolebindings"]
    verbs: ["get", "list", "create", "delete", "update"]
# --------------------------------------------------------------------------------
# ğŸ” Aggregation Rule: Optional â€“ lets other roles dynamically include this one
# --------------------------------------------------------------------------------
aggregationRule:
  clusterRoleSelectors:
    - matchLabels:
        rbac.example.com/aggregate-to-monitoring: "true"  # ğŸ§² Enables auto-inclusion into composite roles
