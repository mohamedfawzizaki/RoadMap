In Helm, **dependencies** allow a chart to include other charts (called **subcharts**) as building blocks. 
This is essential for building **modular**, **reusable**,
 and **maintainable** applications composed of multiple components like databases, caches, and services.

---

## 📦 What Are Dependencies in Helm?

A **dependency** is another Helm chart that your current chart depends on —
 like including `redis`, `postgresql`, or other services in your main app.

Dependencies are declared in your chart’s `Chart.yaml` and downloaded into the `charts/` directory.

---

## 📁 Chart Structure with Dependencies

```
myapp/
├── Chart.yaml              # declares dependencies
├── values.yaml             # provides config for parent + dependencies
├── charts/                 # downloaded subcharts go here
│   └── redis/
├── templates/
│   └── deployment.yaml
```

---

## 🧾 Declaring Dependencies in `Chart.yaml`

```yaml
apiVersion: v2
name: myapp
version: 1.0.0

dependencies:
  - name: redis
    version: "17.11.0"
    repository: "https://charts.bitnami.com/bitnami"

  - name: postgresql
    version: "12.5.0"
    repository: "https://charts.bitnami.com/bitnami"
```

> ✅ Helm v2 uses a separate `requirements.yaml` — **Helm v3** (current) merges this into `Chart.yaml`.

---

## 🔄 Installing/Updating Dependencies

### 1. Download dependencies:

```bash
helm dependency update
```

This fetches the charts listed in `Chart.yaml` and saves them in the `charts/` folder.

### 2. Or build from a `charts/` directory:

```bash
helm dependency build
```

If you're using source control with committed subcharts.

---

## 🧠 How Helm Loads Values for Dependencies

### ✅ From the parent’s `values.yaml`:

```yaml
redis:
  architecture: standalone
  auth:
    enabled: true
    password: mypassword

postgresql:
  postgresqlUsername: admin
  postgresqlPassword: secret
```

Helm will merge these values **into the subcharts** during template rendering.

---

## 🔹 Disabling a Dependency

Most subcharts support an `enabled` flag:

```yaml
redis:
  enabled: false
```

This only works if the subchart is written like:

```yaml
{{- if .Values.enabled }}
apiVersion: v1
kind: Deployment
...
{{- end }}
```

---

## 🌍 Using Global Values

To pass values to **all** charts and subcharts:

```yaml
global:
  environment: production
```

Accessed as:

```yaml
{{ .Values.global.environment }}
```

---

## 🔄 Dependency Resolution Precedence

Helm merges values in this order (lowest to highest priority):

1. Subchart’s own `values.yaml`
2. Parent’s `values.yaml` under `subchartname:`
3. CLI overrides with `--set subchart.key=value`
4. CLI overrides with `--values custom-values.yaml`

---

## 📎 Lock File: `Chart.lock`

After you run `helm dependency update`, Helm creates a **`Chart.lock`** file. 
It contains exact versions of all dependencies:

```yaml
dependencies:
  - name: redis
    version: 17.11.0
    repository: https://charts.bitnami.com/bitnami
digest: sha256:abcd1234...
```

✅ This ensures **reproducible installs**.

You can commit `Chart.lock` and `charts/` to Git to lock dependency versions.

---

## 🛠 Example: Adding Redis as a Dependency

### 1. In `Chart.yaml`:

```yaml
dependencies:
  - name: redis
    version: "17.11.0"
    repository: "https://charts.bitnami.com/bitnami"
```

### 2. In `values.yaml`:

```yaml
redis:
  architecture: standalone
  auth:
    enabled: true
    password: "myredispass"
```

### 3. Run:

```bash
helm dependency update
helm install myapp .
```

---

## 🔍 Verify Dependencies

### List dependencies:

```bash
helm dependency list
```

### See rendered templates:

```bash
helm template myapp .
```

---

## 🔐 Private Repositories or Local Dependencies

### Local chart dependency:

Put a chart archive in `charts/`:

```bash
helm package ../custom-db/
mv custom-db-1.0.0.tgz ./charts/
```

### Private repo authentication:

Use `helm repo add` with credentials or Helm OCI support.

---

## ✅ Summary

| Feature                  | Description                                          |
| ------------------------ | ---------------------------------------------------- |
| `Chart.yaml`             | Where dependencies are declared                      |
| `charts/`                | Where subcharts are stored                           |
| `values.yaml`            | Configures subcharts using keys matching their names |
| `global:` values         | Shared values accessible across all charts           |
| `Chart.lock`             | Locks exact versions of dependencies                 |
| `helm dependency update` | Downloads and saves dependencies                     |

---