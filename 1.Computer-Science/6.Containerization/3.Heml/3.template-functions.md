In Helm, **template functions** and **pipelines** allow you to manipulate and format data in your templates using Go’s powerful templating engine (`text/template` and `sprig` functions). This makes your Helm charts flexible and dynamic.

---

## 🛠 Template Functions in Helm

Template functions **transform data** inside Helm templates. You use them inside `{{ ... }}` blocks.

### 🔹 Syntax:

```yaml
{{ functionName argument1 argument2 }}
```

or with pipelines:

```yaml
{{ value | functionName | anotherFunction }}
```

---

## 🧰 Common Helm Template Functions

### 🔤 String Functions

| Function  | Example                                       | Description              |                                 |
| --------- | --------------------------------------------- | ------------------------ | ------------------------------- |
| `upper`   | \`{{ "nginx"                                  | upper }}`→`NGINX\`       | Converts string to uppercase    |
| `lower`   | \`{{ "NGINX"                                  | lower }}`→`nginx\`       | Converts string to lowercase    |
| `title`   | \`{{ "my app"                                 | title }}`→`My App\`      | Capitalizes each word           |
| `trim`    | \`{{ " foo "                                  | trim }}`→`foo\`          | Removes leading/trailing spaces |
| `repeat`  | `{{ repeat 3 "ha" }}` → `hahaha`              | Repeats a string N times |                                 |
| `replace` | `{{ replace "foo-bar" "-" "_" }}` → `foo_bar` | Replace substrings       |                                 |

---

### 🔢 Numeric & Math Functions

| Function | Example                | Description     |
| -------- | ---------------------- | --------------- |
| `add`    | `{{ add 3 4 }}` → `7`  | Adds numbers    |
| `div`    | `{{ div 8 2 }}` → `4`  | Divides numbers |
| `mul`    | `{{ mul 3 2 }}` → `6`  | Multiplies      |
| `mod`    | `{{ mod 10 3 }}` → `1` | Modulo          |

---

### 🧪 Type Checking & Logic

| Function  | Example                               | Description              |                       |
| --------- | ------------------------------------- | ------------------------ | --------------------- |
| `empty`   | `{{ if empty .Values.foo }}`          | Checks if value is empty |                       |
| `default` | \`{{ .Values.env                      | default "dev" }}\`       | Sets a fallback value |
| `hasKey`  | `{{ hasKey .Values "replicaCount" }}` | Key presence in dict     |                       |

---

### 📦 List and Dict Functions

| Function | Example                            | Description                                     |
| -------- | ---------------------------------- | ----------------------------------------------- |
| `dict`   | `{{ dict "key1" "val1" }}`         | Create a dictionary                             |
| `list`   | `{{ list 1 2 3 }}`                 | Create a list                                   |
| `pluck`  | `{{ pluck "name" .Values.users }}` | Get value for a specific key from list of dicts |

---

### 📁 File Functions

| Function          | Description                           |
| ----------------- | ------------------------------------- |
| `.Files.Get`      | Gets the contents of a file as string |
| `.Files.GetBytes` | Gets raw bytes of a file              |
| `.Files.Glob`     | Gets list of matching files in chart  |

---

## 🔄 Pipelines in Helm

Pipelines are like Linux pipes (`|`). They pass the output of one function into another.

### 🔹 Example:

```yaml
{{ .Values.name | upper | quote }}
```

🔍 What it does:

1. Gets the value of `.Values.name`
2. Converts it to uppercase
3. Wraps it in quotes

---

### 📦 Real-World Example

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-config
data:
  environment: {{ .Values.env | default "development" | quote }}
  app_name: {{ .Chart.Name | upper }}
```

---

## 🔧 Defining Custom Template Helpers (`_helpers.tpl`)

You can define reusable functions in a `_helpers.tpl` file:

```yaml
{{- define "mychart.fullname" -}}
{{ .Release.Name }}-{{ .Chart.Name }}
{{- end }}
```

Then call it in a template:

```yaml
metadata:
  name: {{ include "mychart.fullname" . }}
```

---

## 🧠 Debugging Values with `toYaml`

```yaml
{{- toYaml .Values | indent 2 }}
```

✅ Converts a complex structure to YAML format, very useful for nested config or printing entire `.Values`.

---

## 🚀 Summary

* **Functions**: Transform values (strings, numbers, lists, maps).
* **Pipelines**: Chain multiple functions.
* **`_helpers.tpl`**: Define reusable snippets.
* **Common patterns**:

  * `{{ .Values.name | upper }}`
  * `{{ .Values.port | default 80 }}`
  * `{{ include "mychart.fullname" . }}`

---
